import{I as G,r as y,c as S,z,o as E,f,k as b,l as V,q as n,s as l,m as e,C as t,D as L,v,t as w,F,B as R,E as q,H as C,J as W,K as X,G as Y}from"./entry.d2eac3d2.js";import{h as U}from"./moment.a9aaa855.js";import{c as j}from"./clients.811b60cb.js";import{c as M,r as B,u as J,n as Z,b as ee}from"./index.edcb52a9.js";import{V as te,a as le}from"./VSkeletonLoader.d47c2c61.js";import{g as ae}from"./granary.cc76c106.js";import{s as ne}from"./supplier.895df033.js";const oe={class:"supplierPaymentReportFilter"},se={class:"field_container"},ie=e("label",{for:"supplierId"},"اختر العميل",-1),re={class:"input_parent position-relative"},de={key:0,class:"err_msg"},ce={class:"field_container"},ue=e("label",{for:"granaryId"},"اختر الصومعة",-1),me={class:"input_parent position-relative"},pe={key:0,class:"err_msg"},_e={class:"field_container",dir:"rtl"},ve=e("label",{for:"FromDate"},"من",-1),fe={class:"input_parent position-relative"},ge=["disabled"],ye={class:"field_container",dir:"rtl"},be=e("label",{for:"ToDate"},"الي",-1),De={class:"input_parent position-relative"},he=["disabled"],$e={__name:"Filter",props:["loading","reFilter"],emits:["filterData","refiltered"],setup(r,{emit:I}){const m=r,x=j(),{clientLockup:k}=G(x),a=y({clientID:null,granaryId:null,FromDate:null,ToDate:null}),D=y({clientID:{required:M.withMessage("هذا الحقل مطلوب",B)},granaryId:{required:M.withMessage("هذا الحقل مطلوب",B)}});let d=J(D,a);const P=S(()=>a.value.clientID?k.value.find(g=>g.client.id==a.value.clientID).granaryList:[]);z(()=>m.reFilter,g=>{g&&(h(),I("refiltered"))});const h=async()=>{if(await d.value.$validate()){const o={clientID:a.value.clientID,granaryId:a.value.granaryId,FromDate:a.value.FromDate?U(a.value.FromDate).format("DD/MM/YYYY"):null,ToDate:a.value.ToDate?U(a.value.ToDate).format("DD/MM/YYYY"):null};I("filterData",o)}};return E(()=>{x.doGetClientsLockup()}),(g,o)=>{const c=f("v-autocomplete"),$=f("v-icon"),u=f("v-col"),p=f("v-btn"),T=f("v-row");return b(),V("div",oe,[n(T,{dir:"rtl",class:"pt-0"},{default:l(()=>[n(u,{cols:"12",sm:"6",md:"4",lg:"3",class:"pt-0"},{default:l(()=>[e("div",se,[ie,e("div",re,[n(c,{"item-title":"client.name","item-value":"client.id",items:t(k),transition:"slide-y-transition",variant:"outlined","hide-details":"",modelValue:t(a).clientID,"onUpdate:modelValue":o[0]||(o[0]=i=>t(a).clientID=i),placeholder:"اختر العميل",disabled:r.loading,class:L(t(d).$errors.find(i=>i.$property=="clientID")?"err_field":"")},null,8,["items","modelValue","disabled","class"]),n($,{class:"position-absolute"},{default:l(()=>[v("mdi-account-cowboy-hat")]),_:1})]),t(d).$errors.find(i=>i.$property=="clientID")?(b(),V("span",de,w(t(d).$errors.find(i=>i.$property=="clientID").$message),1)):F("",!0)])]),_:1}),n(u,{cols:"12",sm:"6",md:"4",lg:"3",class:"py-0"},{default:l(()=>[e("div",ce,[ue,e("div",me,[n(c,{"item-title":"name","item-value":"id",items:t(P),transition:"slide-y-transition",variant:"outlined",disabled:r.loading,placeholder:"اختر الصومعة","hide-details":"",modelValue:t(a).granaryId,"onUpdate:modelValue":o[1]||(o[1]=i=>t(a).granaryId=i),class:L(t(d).$errors.find(i=>i.$property=="granaryId")?"err_field":"")},null,8,["items","disabled","modelValue","class"]),n($,{class:"position-absolute"},{default:l(()=>[v("mdi-store-24-hour")]),_:1})]),t(d).$errors.find(i=>i.$property=="clientID")?(b(),V("span",pe,w(t(d).$errors.find(i=>i.$property=="clientID").$message),1)):F("",!0)])]),_:1}),n(u,{cols:"12",sm:"6",md:"4",lg:"3",class:"py-0"},{default:l(()=>[e("div",_e,[ve,e("div",fe,[R(e("input",{type:"datetime-local",name:"FromDate",id:"FromDate",disabled:r.loading,"onUpdate:modelValue":o[2]||(o[2]=i=>t(a).FromDate=i),style:{"padding-right":"0 !important"}},null,8,ge),[[q,t(a).FromDate]]),n($,{class:"position-absolute"},{default:l(()=>[v("mdi-calendar")]),_:1})])])]),_:1}),n(u,{cols:"12",sm:"6",md:"4",lg:"3",class:"py-0"},{default:l(()=>[e("div",ye,[be,e("div",De,[R(e("input",{type:"datetime-local",name:"ToDate","onUpdate:modelValue":o[3]||(o[3]=i=>t(a).ToDate=i),disabled:r.loading,id:"ToDate",style:{"padding-right":"0 !important"}},null,8,he),[[q,t(a).ToDate]]),n($,{class:"position-absolute"},{default:l(()=>[v("mdi-calendar")]),_:1})])])]),_:1}),n(u,{cols:"12",sm:"6",md:"4",lg:"3",style:{display:"flex","align-items":"flex-end"},class:"pt-0"},{default:l(()=>[n(p,{color:"blue",width:"100",height:"40",elevation:"0",onClick:h,class:"font-weight-bold",style:{"margin-bottom":"2px"},disabled:r.loading},{default:l(()=>[v("بحث")]),_:1},8,["disabled"])]),_:1})]),_:1})])}}},xe=$e,we={class:"pay_client_due"},Ie=e("thead",null,[e("tr",null,[e("th",{style:{"background-color":"#f3f3f3 !important"},class:"text-center font-weight-bold"}," تاريخ "),e("th",{style:{"background-color":"#f3f3f3 !important"},class:"text-center font-weight-bold"}," الكمية المتبقية "),e("th",{style:{"background-color":"#f3f3f3 !important"},class:"text-center font-weight-bold"}," حالة الدفع ")])],-1),ke={style:{"font-size":"15px"}},Fe={style:{"font-size":"15px"}},Pe={style:{"font-size":"15px"}},Ve={class:"pt-5"},Ce=e("td",{style:{"font-weight":"bold","font-size":"18px"}},"الاجمالي",-1),Te={style:{"font-weight":"bold","font-size":"18px"}},Me=e("td",null,null,-1),Ge={style:{"background-color":"white !important"}},Ye=e("td",null,null,-1),ze={class:"field_container pt-5"},Ue={class:"input_parent"},Ne={key:0,class:"err_msg pt-2 d-block mb-0 pb-0"},Ae=e("td",null,null,-1),Se={class:"actions text-center mt-5"},Le={__name:"PayNow",props:["openPopup","selected","selectedGranary"],emits:["closePopup","regetData"],setup(r,{emit:I}){const m=r,x=j(),k=y({paymentAmount:null}),a=y(!1),D=y(!1),d=S(()=>{let o=0;return m.selected&&m.selected.length&&m.selected.forEach(c=>o+=c.remaining),o}),P=S(()=>({paymentAmount:{required:M.withMessage("هذا الحقل مطلوب",B),numeric:M.withMessage("هذا الحقل يقبل ارقام فقط",Z),between:M.withMessage(`قم بادخال رقم بين 1 و ${d.value}`,ee(1,d.value))}})),h=J(P,k),g=async()=>{if(await h.value.$validate()){const c={amountToPay:k.value.paymentAmount,duesDTOList:m.selected,granary:{id:m.selectedGranary}};D.value=!0;const $=await x.doPayClients(c);D.value=!1,$&&(I("regetData"),a.value=!1)}};return z(()=>a.value,o=>{o||setTimeout(()=>{I("closePopup")},200)}),E(()=>{a.value=m.openPopup}),(o,c)=>{const $=f("v-card-title"),u=f("v-chip"),p=f("v-table"),T=f("v-btn"),i=f("v-card"),N=f("v-dialog");return b(),V("div",we,[n(N,{modelValue:t(a),"onUpdate:modelValue":c[2]||(c[2]=_=>Y(a)?a.value=_:null),width:"800",persistent:""},{default:l(()=>[n(i,{class:"pb-5","max-height":"90vh"},{default:l(()=>[n($,{class:"mb-0 text-center bg-grey-lighten-3 main_title font-safe-bold",style:{"font-size":"22px"}},{default:l(()=>[v(" اضافة مدفوعات جديدة ")]),_:1}),r.selected&&r.selected.length?(b(),C(p,{key:0,class:"text-center w-100"},{default:l(()=>[Ie,(b(!0),V(W,null,X(r.selected,(_,A)=>(b(),V("tbody",{key:_.id},[e("tr",null,[e("td",ke,w(_.date),1),e("td",Fe,w(_.remaining),1),e("td",Pe,[_.isFullPayed?(b(),C(u,{key:0,color:"green"},{default:l(()=>[v("مكتمل")]),_:1})):F("",!0),_.isFullPayed?F("",!0):(b(),C(u,{key:1,color:"red"},{default:l(()=>[v("غير مكتمل")]),_:1}))])])]))),128)),e("tfoot",null,[e("tr",Ve,[Ce,e("td",Te,w(t(d)),1),Me]),e("tr",Ge,[Ye,e("td",null,[e("div",ze,[e("div",Ue,[R(e("input",{class:L(["px-0 text-center",t(h).$errors.find(_=>_.$property=="paymentAmount")?"err_field":""]),style:{width:"100%"},placeholder:"قم بادخال مبلغ السداد",type:"text","onUpdate:modelValue":c[0]||(c[0]=_=>t(k).paymentAmount=_)},null,2),[[q,t(k).paymentAmount]])]),t(h).$errors.find(_=>_.$property=="paymentAmount")?(b(),V("span",Ne,w(t(h).$errors.find(_=>_.$property=="paymentAmount").$message),1)):F("",!0)])]),Ae])])]),_:1})):F("",!0),e("div",Se,[n(T,{color:"red",class:"mr-3",onClick:c[1]||(c[1]=_=>a.value=!1),width:"100",disabled:t(D)},{default:l(()=>[v("الغاء")]),_:1},8,["disabled"]),n(T,{color:"green",onClick:g,loading:t(D),width:"100"},{default:l(()=>[v("دفع")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["modelValue"])])}}},Re=Le;const qe={class:"dashboard_banners_listing"},Be={class:"page_toolbar d-flex align-center justify-space-between"},Ee={class:"toolbar_btns"},je=e("br",null,null,-1),He=e("div",null,"لايوجد بيانات",-1),Je={key:0,class:"text-end my-5 me-5"},Ke={__name:"Invoices",props:["invoices","loading","suppliers","granaries"],emits:["regetItems","filterData"],setup(r,{emit:I}){const m=y(1),x=y(10),k=y([{title:"رقم",key:"index"},{title:"التاريخ",key:"date"},{title:"اجمالي الكمية",key:"totalQuantitySupplied"},{title:"اجمالي القيمة",key:"totalCompanyDues"},{title:"القيمة المدفوعة",key:"paied"},{title:"القيمة المتبقية",key:"remaining"},{title:"حالة الدفع",key:"isFullPayed"}]),a=[{title:"الرئيسية",disabled:!1,to:{name:"index"}},{title:"مستحقات الشركة",disabled:!0}],D=y([]),d=y(!1),P=y(!1),h=y(""),g=y(""),o=y(""),c=y(""),$=u=>{h.value=u.granaryId,g.value=u.clientID,o.value=u.FromDate,c.value=u.ToDate,D.value=[],I("filterData",{...u,limit:x.value,page:m.value})};return z(()=>m.value,u=>{I("filterData",{FromDate:o.value,ToDate:c.value,clientID:g.value,granaryId:h.value,page:u,limit:x.value})}),z(()=>x.value,u=>{I("filterData",{FromDate:o.value,ToDate:c.value,clientID:g.value,granaryId:h.value,page:m.value,limit:u})}),(u,p)=>{const T=f("v-icon"),i=f("v-btn"),N=f("v-breadcrumbs"),_=xe,A=f("v-col"),H=f("v-chip"),K=f("v-row"),O=f("v-container"),Q=Re;return b(),V("div",qe,[e("div",Be,[e("div",Ee,[n(i,{width:"20",size:"sm",elevation:"0",color:"transparent"},{default:l(()=>[n(T,{color:"white",size:"25"},{default:l(()=>[v("mdi-printer")]),_:1})]),_:1})]),n(N,{items:a,dir:"rtl",class:"pa-0 mb"},{title:l(({item:s})=>[v(w(s.title.toUpperCase()),1)]),_:1})]),n(O,{class:"page_container",fluid:""},{default:l(()=>[r.invoices?(b(),C(K,{key:0,class:"px-4 mt-1"},{default:l(()=>[n(A,{cols:"12",class:"px-0"},{default:l(()=>[n(_,{class:"mb-7",loading:r.loading,onFilterData:$,reFilter:t(P),onRefiltered:p[0]||(p[0]=s=>(P.value=!1,D.value=[]))},null,8,["loading","reFilter"])]),_:1}),n(A,{cols:"12",class:"section_container dashboard_table pa-0"},{default:l(()=>[n(t(te),{headers:t(k),items:r.invoices.content,loading:r.loading,"items-per-page":t(x),"onUpdate:itemsPerPage":p[1]||(p[1]=s=>Y(x)?x.value=s:null),modelValue:t(D),"onUpdate:modelValue":p[2]||(p[2]=s=>Y(D)?D.value=s:null),page:t(m),"onUpdate:page":p[3]||(p[3]=s=>Y(m)?m.value=s:null),"items-length":r.invoices.totalElements?r.invoices.totalElements:0,"no-data-text":"لايوجد بيانات","show-current-page":"",id:"clients_payments","return-object":"","show-select":!!(r.invoices.content&&r.invoices.content.length)},{loading:l(()=>[n(t(le),{type:"table-row@4"})]),"item.index":l(({item:s})=>[v(w(s.index+1),1)]),"item.invoiceDate":l(({item:s})=>[e("p",null,[v(w(t(U)(s.selectable.date).format("DD/MM/YYYY"))+" ",1),je,v(" "+w(t(U)(s.selectable.date).format("hh:mm")),1)])]),"item.totalCompanyDues":l(({item:s})=>[e("p",null,w(Number(s.selectable.totalCompanyDues).toFixed(2)),1)]),"item.paied":l(({item:s})=>[e("p",null,w(Number(s.selectable.paied).toFixed(2)),1)]),"item.remaining":l(({item:s})=>[e("p",null,w(Number(s.selectable.remaining).toFixed(2)),1)]),"item.isFullPayed":l(({item:s})=>[s.selectable.isFullPayed?(b(),C(H,{key:0,color:"green",label:""},{default:l(()=>[v("مكتمل")]),_:1})):F("",!0),s.selectable.isFullPayed?F("",!0):(b(),C(H,{key:1,color:"red",label:""},{default:l(()=>[v("غير مكتمل")]),_:1}))]),"no-data":l(()=>[He]),_:1},8,["headers","items","loading","items-per-page","modelValue","page","items-length","show-select"]),t(D).length?(b(),V("div",Je,[n(i,{color:"green",onClick:p[4]||(p[4]=s=>d.value=!0)},{default:l(()=>[v("دفع")]),_:1})])):F("",!0)]),_:1})]),_:1})):F("",!0)]),_:1}),t(d)?(b(),C(Q,{key:0,openPopup:t(d),onClosePopup:p[5]||(p[5]=s=>d.value=!1),selected:t(D),onRegetData:p[6]||(p[6]=s=>P.value=!0),selectedGranary:t(h)},null,8,["openPopup","selected","selectedGranary"])):F("",!0)])}}},Oe=Ke,Qe={class:"dashboard_clients_payments mb-10"},nt={__name:"index",setup(r){const I=j(),m=ne(),x=ae(),{clientInvoices:k}=G(I),{granaries:a}=G(x),{suppliers:D}=G(m),d=y(!1),P=y({clientID:null,granaryId:null,FromDate:null,ToDate:null}),h=async g=>{d.value=!0,P.value=g||{clientID:null,granaryId:null,FromDate:null,ToDate:null},await I.doGetClientInvoices(g.page-1,g.limit,P.value),d.value=!1};return E(()=>{k.value=[],m.doGetSuppliers(0,1e4),x.doGetGranaries(0,1e4)}),(g,o)=>{const c=Oe;return b(),V("div",Qe,[n(c,{invoices:t(k),loading:t(d),granaries:t(a).content,suppliers:t(D).content,onRegetItems:o[0]||(o[0]=$=>h($.page,$.limit)),onFilterData:o[1]||(o[1]=$=>h($))},null,8,["invoices","loading","granaries","suppliers"])])}}};export{nt as default};
